# 📝 Moss Arcade - Game Design Document (기획서)

## 1. 게임 개요 (Game Overview)
- **게임명**: Moss Arcade
- **장르**: Web-based Casual Arcade / Betting Platform
- **플랫폼**: Web (PC/Mobile Responsive)
- **타겟 유저**: 가볍게 즐길 수 있는 미니게임과 경쟁을 좋아하는 유저
- **핵심 키워드**: 실시간 대전, 골드 배팅, 등급 경쟁, 관전, 소셜

## 2. 핵심 게임 루프 (Core Game Loop)
1. **로비 진입**: 유저는 로비에서 게임을 선택하고 현재 진행 중인 매치를 확인합니다.
2. **매칭/대기**: 게임 룸에 입장하여 다른 플레이어를 기다리거나 관전합니다.
3. **플레이/배팅**: 직접 게임에 참여하거나, 관전하며 **골드(Gold)**를 배팅합니다.
4. **결과 및 보상**: 게임 결과에 따라 승리 수당 또는 배팅 배당금을 획득합니다 (파산 시 무료 충전 기능 제공).
5. **성장/수집**: 업적 달성, 일일 퀘스트 완료, 등급 상승으로 콘텐츠 해금.

## 3. 유저 플로우 (User Flow)
```
[첫 방문] → 회원가입/로그인 → 온보딩 튜토리얼
    → [로비 (Home)]
        ├─ 게임 선택 → 매칭 대기 → 인게임 → 결과 화면 → 로비 복귀
        ├─ 관전 모드 → 배팅 → 결과
        ├─ 친구 목록 / 채팅 / 파티 초대
        ├─ 상점 / 아바타 꾸미기
        ├─ 리더보드 / 전적 조회
        ├─ 일일 퀘스트 / 업적 확인
        └─ 토너먼트 참가
```

## 4. 온보딩 & 튜토리얼 (Onboarding)
- **Step 1**: 닉네임 설정 + 아바타 기본 선택
- **Step 2**: 초기 골드 **300만 G** 지급 연출 (동전 쏟아지는 애니메이션)
- **Step 3**: "첫 게임 해보기" - AI 봇 상대 Neon Deathmatch 1판 체험 (무료)
- **Step 4**: 배팅 방법 안내 (관전 → 배팅 → 결과 확인 흐름)
- **Step 5**: 일일 퀘스트 & 무료 충전소 위치 안내
- **스킵 가능**: 모든 단계에서 "건너뛰기" 버튼 제공

## 5. 주요 기능 (Key Features)

### 5.1. 로비 (Lobby) - **Roblox Style UI**
- **레이아웃 컨셉**: "Discover & Play" - 콘텐츠 탐색 중심의 직관적 UI
- **상단 네비게이션 (Top Bar)**:
    - **Logo**: 홈으로 이동
    - **Search Bar**: 게임, 유저, 친구 검색 (자동완성 지원)
    - **User Asset**: 보유 골드 표시 (클릭시 충전소 이동), 알림(Notification) 아이콘
    - **Profile Menu**: 내 아바타, 설정, 로그아웃 드롭다운

- **메인화면 구성 (Home/Discover)**:
    - **Game Carousel (가로 스크롤)**:
        1.  *Continue Playing*: 최근 플레이한 게임 (이어하기)
        2.  *Recommended for You*: 추천 게임 (알고리즘 기반)
        3.  *Trending Now*: 현재 접속자 급상승 게임
        4.  *Top Rated*: 평점 높은 게임
    - **Game Tile (Card)**:
        - 16:9 썸네일, 게임명, 현재 접속자 수(CCU), 좋아요 비율(%)
        - 호버 시 플레이 버튼 및 간략 정보 오버레이

- **사이드바 (Sidebar/Drawer)**:
    - **Home**: 메인 로비
    - **Avatar**: 내 캐릭터 꾸미기 (상점 연동)
    - **Friends**: 친구 목록, 현재 접속 중인 친구 (Join 기능)
    - **Inventory**: 보유 아이템/스킨 확인
    - **Trade**: 유저 간 아이템/골드 거래소 (추후 구현)
    - **Leaderboard**: 실시간 랭킹 (골드 보유량, 승률)
    - **Tournaments**: 토너먼트 목록 및 참가

- **소셜 패널 (Right Panel/Chat)**:
    - 친구 목록 및 상태 표시 (접속중, 게임중 등)
    - 1:1 채팅 및 파티 초대 기능

- **초기 자금 정책**: 신규 가입 시 **300만 골드 (3,000,000 G)** 지급, 소진 시 30만 골드 무료 충전 (일 5회)

### 5.2. 인게임 (In-Game) - 공통
- **사이드바**: 로비 메뉴 접근 및 빠른 이동
- **배팅 패널**:
    - 실시간 배당률 표시
    - 배팅 금액 조절 (1만 G, 10만 G, 100만 G 단위 등 큰 단위 사용)
    - 플레이어 상태 (Ready/Playing/Ended)
- **게임 컨테이너**: 실제 게임이 렌더링되는 영역 (Canvas/WebGL)
- **채팅**: 해당 게임 룸 참여자 간 대화

### 5.3. 등급 시스템 (Rank System)
- **개요**: 보유 자산(골드) 및 승점에 따라 등급이 결정됩니다 (고스톱 스타일).
- **등급 체계**:
    1. **평민 (Beginner)**: 300만 ~ 1,000만 G (초기 시작)
    2. **중수 (Regular)**: 1,000만 ~ 1억 G (배팅 한도: 50만)
    3. **고수 (High Roller)**: 1억 ~ 10억 G (배팅 한도: 500만)
    4. **지존 (Master)**: 10억 ~ 100억 G (배팅 한도: 5,000만)
    5. **도신 (God)**: 100억 G 이상 (배팅 한도: **무제한**)
- **등급 혜택**: 등급이 오를수록 일일 무료 충전 금액 및 입장 가능한 채널(고액방)이 해금됩니다.

### 5.4. 매칭 시스템 (Matchmaking)
- **빠른 매칭**: 등급 ±1 범위 내 유저와 자동 매칭 (5초 타임아웃 → 범위 확장)
- **방 만들기**: 커스텀 룸 생성 (비밀번호 설정, 최대 인원 조절)
- **친구 초대**: 파티원과 함께 매칭 큐 진입
- **AI 봇 채우기**: 매칭 실패 시 빈 슬롯에 AI 봇 자동 배치 (최소 4인 보장)

### 5.5. 관전 모드 (Spectator Mode)
- **실시간 관전**: 진행 중인 게임방에 관전자로 입장 가능
- **관전 중 배팅**: 관전하면서 실시간으로 승자 예측 배팅
- **딜레이**: 관전 화면 3초 딜레이 (부정행위 방지)
- **관전자 채팅**: 관전자끼리만 보이는 별도 채팅 채널
- **관전자 수 표시**: 게임 룸에 현재 관전자 수 표시 (인기도 지표)

### 5.6. 일일 퀘스트 & 업적 (Daily Quest & Achievement)
#### 일일 퀘스트 (매일 자정 갱신)
| 퀘스트 | 조건 | 보상 |
|--------|------|------|
| 첫 접속 | 로그인 | 5만 G |
| 도전자 | 게임 3판 플레이 | 10만 G |
| 승리자 | 게임 1판 승리 | 20만 G |
| 예측가 | 관전 배팅 3회 | 5만 G |
| 사교왕 | 채팅 메시지 10개 전송 | 3만 G |

- **연속 출석 보너스**: 7일 연속 로그인 시 **100만 G** 추가 지급
- **퀘스트 리롤**: 1일 1회 마음에 안 드는 퀘스트 변경 가능

#### 업적 시스템 (Achievement)
- **티어 구조**: 🥉 Bronze → 🥈 Silver → 🥇 Gold
- 예시: "첫 승리", "100연승", "1억 G 달성", "도신 등극", "500판 플레이"
- **보상**: 칭호(Title), 아바타 프레임, 한정 스킨, 골드
- **프로필 배지 표시**: 달성한 업적 중 최대 3개를 프로필에 장착 가능

### 5.7. 알림 시스템 (Notification)
- **인앱 알림 (Toast)**: 골드 변동, 친구 접속, 매칭 완료, 퀘스트 달성
- **알림 센터 (벨 아이콘)**: 읽지 않은 알림 모아보기 (빨간 뱃지 카운트)
- **푸시 알림 (추후)**: 브라우저 푸시로 토너먼트 시작, 친구 초대 알림

## 6. 포함된 게임 (Included Games)
### 6.1. Neon Deathmatch (ID: 8)
- **방식**: 8인 배틀로얄
- **조작**: WASD (이동), SPACE (대시)
- **규칙**: 원형 경기장에서 상대를 밀쳐내어 떨어뜨리는 최후의 1인 승리
- **특징**: 시간이 지날수록 경기장이 좁아짐 (배틀그라운드 자기장 시스템)
- **배팅 옵션**: 1등 예측, 톱3 예측, 최후의 2인 예측

### 6.2. Billiards (ID: 1)
- **방식**: 1v1 당구
- **상태**: 기본 구현 완료

### 6.3. (추가 예정 후보)
- 알까기, 러시안룰렛, 가위바위보, 체스, 하키 퍽

## 7. 토너먼트 시스템 (Tournament)
- **형식**: 8강/16강 **싱글 엘리미네이션** (패배 즉시 탈락)
- **참가비**: 등급별 참가비 (예: 평민방 10만 G, 고수방 500만 G)
- **상금 풀**: 참가비 총합의 90% (10%는 운영 수수료 = Sink)
- **일정**: 매일 정해진 시간(예: 20:00, 22:00)에 자동 개최
- **대진표 UI**: 실시간 업데이트되는 토너먼트 브래킷 표시
- **관전 연동**: 결승전 자동 관전 방 개설 (로비 배너 홍보)

## 8. 디자인 컨셉 (Design Concept)
- **비주얼 테마**: Dark Neon / Cyberpunk
- **컬러 팔레트**: #000000 (Bg), #00ff99 (Primary), #ff0066 (Accent), #ffff00 (Gold)
- **폰트**: Orbitron (타이틀), Inter/Noto Sans KR (본문)
- **애니메이션 원칙**:
    - 골드 변동 시 숫자 롤링 애니메이션
    - 등급 승급 시 전체화면 축하 이펙트
    - 버튼 호버/클릭 시 네온 글로우 효과
    - 페이지 전환 시 부드러운 슬라이드 트랜지션

## 9. 시스템 아키텍처 (System Architecture)
### 9.1. 기술 스택 (Tech Stack)
- **Frontend**: React (Vite), TypeScript, Tailwind CSS
- **Backend**: Node.js, Express
- **Real-time Communication**: **Socket.IO** (Room 기반 게임 세션 관리)
- **인증**: JWT (Access Token + Refresh Token)
- **Database**:
    - **PostgreSQL/MySQL**: 사용자 정보, 자산(Gold), 결제 로그 (ACID 트랜잭션 보장)
    - **Redis**: 실시간 게임 세션 상태, 채팅 캐싱, 리더보드 (고속 Read/Write)

### 9.2. 서버 구조 (Server Structure)
- **API Server**: 로그인, 회원가입, 랭킹 조회, 상점 구매 등 (RESTful)
- **Game Server**: Socket.IO 기반 실시간 게임 로직 처리 (Server-Authoritative)
    - **Room Manager**: 게임 방 생성/삭제, 매칭 관리
    - **Game Loop**: 약 20~60 FPS로 게임 상태 연산 및 브로드캐스팅
    - **Matchmaker**: Redis Queue 기반 매칭 대기열 관리

## 10. 데이터베이스 설계 (Database Schema)
### 10.1. Users Table
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `uuid` (PK) | UUID | 사용자 고유 ID |
| `email` | VARCHAR | 로그인 이메일 |
| `password_hash` | VARCHAR | 암호화된 비밀번호 |
| `nickname` | VARCHAR(20) | 표시 이름 (유니크) |
| `avatar_url` | TEXT | 아바타 이미지 경로 |
| `gold` | BIGINT | 보유 재화 (정합성 필수) |
| `rank_tier` | ENUM | 현재 등급 (평민~도신) |
| `total_wins` | INT | 총 승리 수 |
| `total_games` | INT | 총 게임 수 |
| `login_streak` | INT | 연속 출석 일수 |
| `last_login_at` | TIMESTAMP | 마지막 로그인 |
| `created_at` | TIMESTAMP | 가입일 |

### 10.2. GameLogs Table (Economy Log)
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `log_id` (PK) | BIGINT AUTO | 로그 고유 ID |
| `user_id` (FK) | UUID | 유저 참조 |
| `type` | ENUM | 'BET', 'WIN', 'REFILL', 'QUEST', 'TOURNAMENT' |
| `amount` | BIGINT | 변동 금액 (+/-) |
| `balance_after` | BIGINT | 변동 후 잔액 (검증용) |
| `game_id` | VARCHAR | 관련 게임 세션 ID |
| `created_at` | TIMESTAMP | 발생 시각 |

### 10.3. Friends Table
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `id` (PK) | BIGINT AUTO | 고유 ID |
| `user_id` (FK) | UUID | 요청자 |
| `friend_id` (FK) | UUID | 대상 |
| `status` | ENUM | 'PENDING', 'ACCEPTED', 'BLOCKED' |
| `created_at` | TIMESTAMP | 요청 시각 |

### 10.4. Achievements Table
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `id` (PK) | BIGINT AUTO | 고유 ID |
| `user_id` (FK) | UUID | 유저 참조 |
| `achievement_key` | VARCHAR | 업적 코드 (예: 'FIRST_WIN') |
| `tier` | ENUM | 'BRONZE', 'SILVER', 'GOLD' |
| `unlocked_at` | TIMESTAMP | 달성 시각 |

### 10.5. DailyQuests Table
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `id` (PK) | BIGINT AUTO | 고유 ID |
| `user_id` (FK) | UUID | 유저 참조 |
| `quest_key` | VARCHAR | 퀘스트 코드 |
| `progress` | INT | 현재 진행도 |
| `target` | INT | 목표치 |
| `reward_gold` | INT | 보상 골드 |
| `completed` | BOOLEAN | 완료 여부 |
| `quest_date` | DATE | 해당 날짜 |

### 10.6. Tournaments Table
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `id` (PK) | BIGINT AUTO | 고유 ID |
| `game_type` | VARCHAR | 게임 종류 |
| `entry_fee` | BIGINT | 참가비 |
| `prize_pool` | BIGINT | 총 상금 |
| `max_players` | INT | 최대 참가자 |
| `bracket_data` | JSON | 대진표 데이터 |
| `status` | ENUM | 'UPCOMING', 'LIVE', 'FINISHED' |
| `starts_at` | TIMESTAMP | 시작 시각 |

## 11. 경제 밸런스 (Economy Balance)
### 골드 유입 (Sources / Faucets)
| 항목 | 금액 | 빈도 |
|------|------|------|
| 초기 지급 | 300만 G | 1회 |
| 무료 충전 | 30만 G | 일 5회 (파산 시) |
| 일일 퀘스트 전체 | ~43만 G | 매일 |
| 연속 출석 7일 | 100만 G | 주 1회 |
| 광고 시청(Rewarded) | 30만 G | 일 5회 |
| 게임 승리 배당 | 가변 | 무제한 |

### 골드 유출 (Sinks / Drains)
| 항목 | 설명 |
|------|------|
| 게임 배팅 | 핵심 Sink (House Edge 5~10%) |
| 토너먼트 참가비 | 참가비의 10% = 운영 수수료 |
| 상점 스킨 구매 | 영구 보유 코스메틱 |
| 거래소 수수료 (추후) | 유저간 거래 시 5% 수수료 |

### 인플레이션 방지 정책
- 무료 충전은 **10만 G 미만**일 때만 가능 (과도한 유입 방지)
- 배팅 패배 시 골드 소멸 = 자연스러운 Sink
- 상위 등급(도신) 전용 고액 배팅방 → 고액 골드 빠르게 순환

## 12. 보안 및 어뷰징 방지 (Security)
- **Server-Authoritative**: 모든 피격, 이동, 점수 계산은 서버에서 검증 (클라이언트는 렌더링만 담당)
- **Rate Limiting**: Socket 이벤트 도배 방지
- **트랜잭션 검증**: 클라이언트가 보낸 배팅 금액이 실제 서버 보유량과 일치하는지 더블 체크
- **중복 로그인 방지**: 동일 계정 동시 접속 차단 (Socket Session ID 관리)
- **다계정 감지**: 동일 IP/디바이스 핑거프린트에서 다수 계정 생성 시 경고
- **비정상 행위 감지**: 연속 즉시 배팅+탈퇴 패턴, 매크로 의심 행위 로깅

## 13. 운영 및 관리 도구 (Admin & Operations)
### 13.1. Admin Dashboard
- **유저 관리**: 유저 검색, 골드 수정(보상/회수), 밴(Ban) 처리
- **게임 로그 조회**: 특정 유저의 배팅/승패 기록 원장 조회 (분쟁 해결용)
- **공지사항 관리**: 로비 상단 롤링 공지 등록
- **실시간 모니터링**: 현재 접속자 수(CCU), 활성화된 게임 방 현황
- **경제 대시보드**: 전체 골드 유통량, 일일 유입/유출 그래프 (인플레이션 모니터링)

### 13.2. 재접속 및 네트워크 처리 (Network Stability)
- **재접속(Reconnection)**:
    - 유저가 게임 중 새로고침/네트워크 끊김 발생 시 `Socket ID`가 끊기더라도 `User ID` 기준으로 30초 내 재접속 시 기존 방/상태 유지
- **비정상 종료 처리**:
    - 배팅 후 게임 강제 종료 시 '패배(기권)' 처리 원칙 (악의적 회피 방지)
    - 서버 다운 등 불가항력 시 해당 판 무효화 및 배팅금 롤백

## 14. 수익화 모델 (Monetization - BM)
- **광고 (Ads)**:
    - 무료 충전소: Reward Video Ads 확인 후 30만 골드 지급
    - 배너 광고: 로비 하단/사이드바 영역
- **인앱 결제 (IAP) - *추후 도입***:
    - **골드 구매**: 유료 재화로 골드 직접 구매
    - **프리미엄 멤버십**: 닉네임 색상 변경, 전용 이모티콘, 수수료 할인 혜택
    - **스킨(Cosmetic)**: 게임 내 캐릭터/오브젝트 스킨 (능력치 영향 X)
    - **배틀패스 (시즌제)**: 월정액으로 시즌 보상 트랙 해금 (무료 트랙 + 프리미엄 트랙)

## 15. 사운드 및 리소스 (Assets)
- **BGM**:
    - 로비: Cyberpunk 스타일의 차분한 루프
    - 인게임: 긴장감을 주는 빠른 템포의 일렉트로닉
    - 결과 화면: 승리(팡파르) / 패배(차분한 피아노)
- **SFX**:
    - UI: 버튼 클릭(메카닉음), 골드 획득(동전 소리), 배팅 성공
    - 인게임: 충돌, 대시, 승리/패배 알림음
    - 알림: 퀘스트 달성(깨지는 유리음), 등급 승급(팡파르)

## 16. 향후 로드맵 (Roadmap)
| 단계 | 내용 | 우선순위 |
|------|------|----------|
| Phase 1 | 골드 시스템 + 로비 UI 리뉴얼 | 🔴 최우선 |
| Phase 2 | 매칭/관전 + 채팅 연동 | 🟠 높음 |
| Phase 3 | 일일퀘스트 + 업적 + 알림 | 🟡 중간 |
| Phase 4 | 토너먼트 + 리더보드 | 🟡 중간 |
| Phase 5 | 상점(스킨/아바타) + 거래소 | 🟢 낮음 |
| Phase 6 | 배틀패스 + IAP 결제 | 🟢 낮음 |

---
**💡 기획 논의 메모**
- 이곳에 유저와의 대화 내용을 바탕으로 기획 내용을 구체화하여 기록합니다.
